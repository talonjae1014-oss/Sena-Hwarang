<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”¥ í™”ë‘ ê¸¸ë“œì „ (Dark UI)</title>
<style>
  /* --- ìŠ¤íƒ€ì¼ 3: ë‹¤í¬ ëª¨ë“œ & ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜ ë””ìì¸ --- */
  
  :root {
    --bg-color: #050505;
    --text-color: #e0e0e0;
    --accent-color: #4facfe;
    --glass-bg: rgba(255, 255, 255, 0.05);
    --glass-border: rgba(255, 255, 255, 0.1);
    --glass-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
  }

  body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: 'Suit', sans-serif;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    padding-bottom: 80px; /* footer ê³µê°„ í™•ë³´ */
  }

  h1, h2, h3, h4 { margin: 0 0 10px 0; font-weight: 700; color: #fff; }
  
  /* ì…ë ¥ì°½ ë° ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
  input, select, textarea {
    background: #1a1a1a;
    border: 1px solid #333;
    color: #fff;
    padding: 10px;
    border-radius: 6px;
    width: 100%;
    box-sizing: border-box;
    margin-bottom: 5px;
  }
  
  button {
    cursor: pointer;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-weight: bold;
    transition: 0.2s;
  }

  /* ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ */
  .action-btn { background: var(--accent-color); color: #000; }
  .action-btn:hover { filter: brightness(1.2); }
  
  /* --- ì»¤ìŠ¤í…€ ë“œë¡­ë‹¤ìš´ (ë°©ì–´íŒ€ ì„ íƒ) --- */
  .dropdown-container {
    margin-bottom: 25px;
    position: relative;
    max-width: 100%;
    z-index: 1000;
  }

  .dropdown-label {
    font-size: 0.9rem;
    color: #888;
    margin-bottom: 8px;
    margin-left: 4px;
  }

  .glass-box {
    background: var(--glass-bg);
    border: 1px solid var(--glass-border);
    border-radius: 12px;
    padding: 18px;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    box-shadow: var(--glass-shadow);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .glass-box:hover {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 15px rgba(79, 172, 254, 0.2);
  }

  #defCurrentText { font-weight: bold; font-size: 1.1rem; color: #fff; }

  .dropdown-options {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    background: #111;
    border: 1px solid #333;
    border-radius: 12px;
    margin-top: 8px;
    max-height: 350px;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.9);
  }

  .dropdown-options.show { display: block; animation: slideDown 0.2s ease-out; }

  .option-item {
    padding: 15px;
    border-bottom: 1px solid #222;
    cursor: pointer;
    transition: background 0.2s;
  }
  .option-item:hover { background: #222; color: var(--accent-color); }
  .option-name { font-weight: bold; display: block; margin-bottom: 3px;}
  .option-stat { font-size: 0.8rem; color: #777; }

  /* --- ê³µê²©íŒ€ ë¦¬ìŠ¤íŠ¸ --- */
  #attackList {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
  }

  .attack-btn {
    background: #111;
    border: 1px solid #333;
    color: #ccc;
    padding: 15px 5px;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    min-height: 80px;
    position: relative;
    overflow: hidden;
  }

  .attack-btn.active {
    background: #000;
    border: 1px solid var(--accent-color);
    color: #fff;
    box-shadow: 0 0 10px rgba(79, 172, 254, 0.4);
  }

  .attack-btn b { font-size: 1rem; margin-bottom: 5px; display: block; }
  .fire-icon { color: #ff4444; font-weight: bold; }

  /* --- ìƒì„¸ ì •ë³´ ì¹´ë“œ --- */
  #attackCard {
    background: rgba(20, 20, 20, 0.8);
    border: 1px solid #333;
    border-radius: 12px;
    padding: 20px;
    margin-top: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    display: none;
  }

  .stat-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin: 15px 0;
    font-size: 0.9rem;
  }
  .stat-item { background: #222; padding: 10px; border-radius: 6px; }
  .stat-label { color: #888; font-size: 0.75rem; display: block; margin-bottom: 3px; }

  .win-btn { background: #28a745; color: #fff; width: 48%; padding: 15px; }
  .lose-btn { background: #dc3545; color: #fff; width: 48%; padding: 15px; }
  
  /* --- ë­í‚¹/í†µê³„ ì„¹ì…˜ --- */
  #rankingSection {
    margin-top: 40px;
    border-top: 1px solid #333;
    padding-top: 20px;
  }
  .rank-item {
    display: flex; justify-content: space-between;
    padding: 10px; border-bottom: 1px solid #222;
    font-size: 0.9rem;
  }
  .rank-item:last-child { border-bottom: none; }

  /* --- í•˜ë‹¨ ì œì‘ì Footer --- */
  footer {
    text-align: center;
    margin-top: 50px;
    padding: 20px;
    color: #555;
    font-size: 0.8rem;
    border-top: 1px solid #111;
  }

  /* ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes slideDown {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  #adminPanel {
    background: #222; padding: 15px; border-radius: 10px; margin-top: 20px; display: none;
    border: 1px solid #444;
  }
</style>
</head>
<body>

<div id="loginScreen" style="text-align:center; margin-top:100px;">
  <h2 style="font-size:2rem; margin-bottom:30px;">ğŸ”¥ í™”ë‘ ê¸¸ë“œì „</h2>
  <div style="background:#111; padding:30px; border-radius:15px; display:inline-block; border:1px solid #333;">
    <input type="text" id="nickInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" style="width:200px; text-align:center; margin-bottom:15px;"><br>
    <button class="action-btn" onclick="enterSite()" style="width:100%;">ì „íˆ¬ ì…ì¥í•˜ê¸°</button>
  </div>
</div>

<div id="mainScreen" style="display:none; max-width: 600px; margin: 0 auto;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <span id="currentNick" style="color:var(--accent-color); font-weight:bold;"></span>
    <button onclick="toggleAdmin()" id="adminBtn" style="background:#333; color:#fff; font-size:0.8rem;">+ ê´€ë¦¬ììš©</button>
  </div>

  <div class="dropdown-container">
    <div class="dropdown-label">ğŸ›¡ï¸ ë°©ì–´íŒ€ ì„ íƒ</div>
    <div id="defSelected" class="glass-box" onclick="toggleDropdown()">
      <span id="defCurrentText">ë°©ì–´íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš” â–¼</span>
    </div>
    <div id="defOptions" class="dropdown-options">
      </div>
  </div>

  <div id="attackList"></div>

  <div id="attackCard">
    <h2 style="border-bottom:1px solid #444; padding-bottom:10px;">
      <span id="cardFire"></span> <span id="cardName"></span>
      <span style="float:right; font-size:0.6em; color:#888; font-weight:normal;">
        <span id="cardRate" style="color:#fff; font-size:1.4em; font-weight:bold;">0</span>%
      </span>
    </h2>

    <div class="stat-grid">
      <div class="stat-item"><span class="stat-label">ì „ì </span><span id="cardWin">0</span>ìŠ¹ <span id="cardLose">0</span>íŒ¨ (ì´ <span id="cardTotal">0</span>ì „)</div>
      <div class="stat-item"><span class="stat-label">íƒ€ì…</span><span id="cardType">-</span></div>
      <div class="stat-item"><span class="stat-label">ì§„í˜•/í«</span><span id="cardRing">-</span></div>
      <div class="stat-item"><span class="stat-label">ìŠ¤í‚¬ìˆœì„œ</span><span id="cardSkill">-</span></div>
      <div class="stat-item" style="grid-column: span 2;"><span class="stat-label">ì˜ì›…/ì¥ë¹„/íŠ¹ì´ì‚¬í•­</span><span id="cardArmor">-</span></div>
      <div class="stat-item" style="grid-column: span 2;">
        <span class="stat-label">ìµœê·¼ 5ê²½ê¸° ê¸°ë¡</span>
        <div id="recentRecord" style="font-size:1.2rem; letter-spacing:3px; margin-top:5px;">-</div>
      </div>
    </div>

    <div style="display:flex; justify-content:space-between; margin-top:15px;">
      <button class="win-btn" onclick="addWin()">ğŸ† ìŠ¹ë¦¬ ê¸°ë¡</button>
      <button class="lose-btn" onclick="addLose()">ğŸ’€ íŒ¨ë°° ê¸°ë¡</button>
    </div>
    <div style="text-align:right; margin-top:10px;">
       <button onclick="resetRecord()" style="background:transparent; color:#666; font-size:0.8rem; text-decoration:underline;">ê¸°ë¡ ì´ˆê¸°í™” (ê´€ë¦¬ì)</button>
    </div>
  </div>

  <div id="adminPanel">
    <h3>ğŸ› ï¸ ë°ì´í„° ê´€ë¦¬</h3>
    <hr style="border-color:#444;">
    <h4>ë°©ì–´íŒ€ ê´€ë¦¬</h4>
    <input type="text" id="defName" placeholder="ìƒˆ ë°©ì–´íŒ€ ì´ë¦„">
    <button onclick="addDefense()" style="background:#444; color:#fff;">ì¶”ê°€</button>
    <button onclick="delDefense()" style="background:#500; color:#fff;">í˜„ì¬ ë°©ì–´íŒ€ ì‚­ì œ</button>
    
    <hr style="border-color:#444; margin:15px 0;">
    <h4>ê³µê²©íŒ€(ë±) ê´€ë¦¬</h4>
    <input type="text" id="atkName" placeholder="ê³µê²©íŒ€ ì´ë¦„">
    <input type="text" id="atkType" placeholder="íƒ€ì… (ë§ŒëŠ¥í˜• ë“±)">
    <input type="text" id="ringRec" placeholder="ì§„í˜•/í«">
    <textarea id="armorRec" rows="3" placeholder="ì˜ì›…/ì¥ë¹„/íŠ¹ì´ì‚¬í•­"></textarea>
    <input type="text" id="skillOrder" placeholder="ìŠ¤í‚¬ ìˆœì„œ">
    <div style="margin-top:5px;">
      <button onclick="addAttack()" style="background:#444; color:#fff;">ì¶”ê°€</button>
      <button onclick="editAttack()" style="background:#0056b3; color:#fff;">ìˆ˜ì • ì €ì¥</button>
      <button onclick="delAttack()" style="background:#500; color:#fff;">ì‚­ì œ</button>
    </div>
  </div>

  <div id="rankingSection">
    <h3 style="color:#888; font-size:1rem;">ğŸ“Š ê¸¸ë“œì› ì°¸ì—¬ í˜„í™©</h3>
    <div id="rankingList" style="background:#111; border-radius:8px; padding:10px;">
      <div style="text-align:center; color:#555;">ê¸°ë¡ ë¡œë”©ì¤‘...</div>
    </div>
  </div>

  <footer>
    <div style="margin-bottom:5px;">Designed & Developed by <b>í™”ë‘</b></div>
    <div style="font-size:0.7rem; color:#444;">Copyright Â© 2024 Hwarang Guild. All rights reserved.</div>
  </footer>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, update, push, set, get, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

/* Firebase ì„¤ì • */
const firebaseConfig = {
  apiKey: "AIzaSyACr8bD-ZrJTwXvyiQTrxacrsQshepRbB8",
  authDomain: "sena-hwarang.firebaseapp.com",
  databaseURL: "https://sena-hwarang-default-rtdb.firebaseio.com",
  projectId: "sena-hwarang",
  storageBucket: "sena-hwarang.firebasestorage.app",
  messagingSenderId: "374306466048",
  appId: "1:374306466048:web:a97a7bc4c9ea886e0a6be5"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const ADMIN_PW = "1513";

let myNick = "";
let currentDefense = "";
let currentAttack = "";
let adminOpen = false;

window.onload = () => {
  myNick = localStorage.getItem("nickname");
  if (!myNick) {
    document.getElementById("loginScreen").style.display = "block";
    document.getElementById("mainScreen").style.display = "none";
  } else {
    document.getElementById("loginScreen").style.display = "none";
    document.getElementById("mainScreen").style.display = "block";
    document.getElementById("currentNick").textContent = `ì‚¬ë ¹ê´€ : ${myNick}`;
  }
};

window.enterSite = () => {
  const n = document.getElementById("nickInput").value.trim();
  if (!n) return alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”");
  myNick = n;
  localStorage.setItem("nickname", myNick);
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("mainScreen").style.display = "block";
  document.getElementById("currentNick").textContent = `ì‚¬ë ¹ê´€ : ${myNick}`; 
};

function checkPW(){
  const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥");
  if(pw !== ADMIN_PW) { alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜"); return false; }
  return true;
}

window.toggleAdmin = () => {
  const panel = document.getElementById("adminPanel");
  const btn = document.getElementById("adminBtn");
  
  if(!adminOpen){
    if(!checkPW()) return;
    panel.style.display="block";
    btn.textContent="âˆ’ ê´€ë¦¬ììš© ë‹«ê¸°";
    adminOpen=true;
  }else{
    panel.style.display="none";
    btn.textContent="+ ê´€ë¦¬ììš©";
    adminOpen=false;
  }
};

/* ë“œë¡­ë‹¤ìš´ UI ì œì–´ */
window.toggleDropdown = () => {
  document.getElementById("defOptions").classList.toggle("show");
};

window.addEventListener('click', (e) => {
  if (!e.target.closest('.dropdown-container')) {
    document.getElementById("defOptions").classList.remove("show");
  }
});

/* ë°©ì–´íŒ€ ëª©ë¡ */
onValue(ref(db, "defenseTeams"), snap => {
  const optionsDiv = document.getElementById("defOptions");
  optionsDiv.innerHTML = "";
  
  const d = snap.val();
  if (!d) {
    document.getElementById("defCurrentText").textContent = "ë°ì´í„° ì—†ìŒ";
    return;
  }
  
  Object.entries(d).forEach(([k, v]) => {
    const tWins = Object.values(v.attackTeams || {}).reduce((a, b) => a + (b.win || 0), 0);
    const tLose = Object.values(v.attackTeams || {}).reduce((a, b) => a + (b.lose || 0), 0);
    const rate = (tWins + tLose) ? Math.round(tWins / (tWins + tLose) * 100) : 0;
    
    const div = document.createElement("div");
    div.className = "option-item";
    div.innerHTML = `<span class="option-name">${v.name}</span><span class="option-stat">ì„±ê³µë¥  ${rate}% (${tWins}ìŠ¹ ${tLose}íŒ¨)</span>`;
    div.onclick = () => {
      document.getElementById("defCurrentText").innerHTML = `${v.name} <span style="font-size:0.8em; color:#888;">(${rate}%)</span>`;
      document.getElementById("defOptions").classList.remove("show");
      loadAttackTeams(k);
    };
    optionsDiv.appendChild(div);
  });
});

/* ê³µê²©íŒ€ ëª©ë¡ ë¡œë“œ */
window.loadAttackTeams = (dk) => {
  currentDefense = dk;
  currentAttack = ""; 
  const attackCard = document.getElementById("attackCard");
  const attackList = document.getElementById("attackList");
  
  if(attackCard) attackCard.style.display = "none";
  attackList.innerHTML = "";

  onValue(ref(db, `defenseTeams/${dk}/attackTeams`), snap => {
    attackList.innerHTML = "";
    const d = snap.val(); if(!d) return;
    
    Object.entries(d).forEach(([ak, av]) => {
      const t = av.win + av.lose;
      const r = t ? Math.round(av.win/t*100) : 0;
      
      const b = document.createElement("button");
      b.className = "attack-btn";
      b.innerHTML = `<b>${r>=70 ? "<span class='fire-icon'>ğŸ”¥</span> " : ""}${av.name}</b><span style="font-size:0.85rem; color:#888;">${r}% (${av.win}ìŠ¹ ${av.lose}íŒ¨)</span>`;
      
      b.onclick = () => {
        document.querySelectorAll(".attack-btn").forEach(btn => btn.classList.remove("active"));
        b.classList.add("active");
        selectAttack(dk, ak);
      };
      attackList.appendChild(b);
    });
  });
};

/* ìƒì„¸ ì •ë³´ ë¡œë“œ */
window.selectAttack = (dk, ak) => {
  currentAttack = ak;
  onValue(ref(db,`defenseTeams/${dk}/attackTeams/${ak}`), snap => {
    const d = snap.val(); if(!d) return;
    const attackCard = document.getElementById("attackCard");
    attackCard.style.display = "block";
    
    document.getElementById("cardName").textContent = d.name;
    document.getElementById("cardWin").textContent = d.win;
    document.getElementById("cardLose").textContent = d.lose;
    
    const total = d.win + d.lose;
    document.getElementById("cardTotal").textContent = total;
    const rateVal = total ? Math.round(d.win / total * 100) : 0;
    document.getElementById("cardRate").textContent = rateVal;
    document.getElementById("cardFire").textContent = rateVal >= 70 ? "ğŸ”¥" : "";
    
    document.getElementById("cardType").textContent = d.type || "-";
    document.getElementById("cardRing").textContent = d.ring || "-";
    document.getElementById("cardArmor").innerHTML = (d.armor || "-").replace(/\n/g,"<br>");
    document.getElementById("cardSkill").textContent = d.skill || "-";
    
    loadRecentRecord(dk, ak);

    document.getElementById("atkName").value = d.name; 
    document.getElementById("atkType").value = d.type; 
    document.getElementById("ringRec").value = d.ring; 
    document.getElementById("armorRec").value = d.armor; 
    document.getElementById("skillOrder").value = d.skill;
  });
};

async function loadRecentRecord(defenseKey, attackKey){
  const snap = await get(ref(db,"logs"));
  const recentDiv = document.getElementById("recentRecord");
  if(!snap.exists()) { recentDiv.innerHTML = "-"; return; }
  
  const logs = Object.values(snap.val())
    .filter(v => v.defense === defenseKey && v.attack === attackKey)
    .sort((a,b)=>b.time-a.time).slice(0,5);
    
  let html = "";
  logs.forEach(v => { html += (v.result === "win" ? "<span style='color:#4caf50;'>W</span> " : "<span style='color:#f44336;'>L</span> "); });
  recentDiv.innerHTML = html || "-";
}

async function canInput(){
  const today = new Date().toISOString().slice(0,10);
  const snap = await get(ref(db,"logs"));
  let cnt = 0;
  if(snap.exists()){
    Object.values(snap.val()).forEach(v=>{
      if(v.nick===myNick && v.date===today) cnt++;
    });
  }
  return cnt < 5;
}

async function writeLog(result){
  if(!currentDefense || !currentAttack) return alert("âš ï¸ íŒ€ ì„ íƒ ì˜¤ë¥˜");
  const snap = await get(ref(db, `defenseTeams/${currentDefense}/attackTeams/${currentAttack}`));
  if(!snap.exists()) {
    alert("âš ï¸ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    loadAttackTeams(currentDefense);
    return;
  }
  const atk = snap.val();
  set(push(ref(db,"logs")),{
    nick: myNick, result, defense: currentDefense, attack: currentAttack,
    attackName: atk.name || "", attackType: atk.type || "",
    date: new Date().toISOString().slice(0,10), time: Date.now()
  });
}

window.addWin = async () => {
  if(!currentDefense || !currentAttack) return alert("âš ï¸ ê³µê²©íŒ€ì„ ì„ íƒí•˜ì„¸ìš”.");
  if (!await canInput()) return alert("í•˜ë£¨ ìµœëŒ€ 5íšŒ");
  if (!confirm(`ìŠ¹ë¦¬ ê¸°ë¡ì„ ì €ì¥í• ê¹Œìš”?`)) return;
  const winEl = document.getElementById("cardWin");
  update(ref(db, `defenseTeams/${currentDefense}/attackTeams/${currentAttack}`), { win: +winEl.textContent + 1 });
  writeLog("win");
};

window.addLose = async () => {
  if(!currentDefense || !currentAttack) return alert("âš ï¸ ê³µê²©íŒ€ì„ ì„ íƒí•˜ì„¸ìš”.");
  if (!await canInput()) return alert("í•˜ë£¨ ìµœëŒ€ 5íšŒ");
  if (!confirm(`íŒ¨ë°° ê¸°ë¡ì„ ì €ì¥í• ê¹Œìš”?`)) return;
  const loseEl = document.getElementById("cardLose");
  update(ref(db, `defenseTeams/${currentDefense}/attackTeams/${currentAttack}`), { lose: +loseEl.textContent + 1 });
  writeLog("lose");
};

window.resetRecord = () => {
  if(!checkPW()) return;
  if(!currentAttack) return alert("ê³µê²©íŒ€ ì„ íƒ í•„ìš”");
  update(ref(db,`defenseTeams/${currentDefense}/attackTeams/${currentAttack}`),{win:0,lose:0});
};

window.addDefense = ()=>{ 
  if(checkPW()) set(push(ref(db,"defenseTeams")),{name:document.getElementById("defName").value, attackTeams:{}}); 
};
window.delDefense = ()=>{ if(checkPW()) remove(ref(db,"defenseTeams/"+currentDefense)); };

window.addAttack = ()=>{
  if(!checkPW()) return;
  set(push(ref(db,`defenseTeams/${currentDefense}/attackTeams`)),{
    name: document.getElementById("atkName").value, 
    type: document.getElementById("atkType").value, 
    ring: document.getElementById("ringRec").value, 
    armor: document.getElementById("armorRec").value, 
    skill: document.getElementById("skillOrder").value, 
    win:0, lose:0
  });
};
window.editAttack = ()=>{
  if(!checkPW() || !currentAttack) return;
  update(ref(db,`defenseTeams/${currentDefense}/attackTeams/${currentAttack}`),{
    name: document.getElementById("atkName").value, 
    type: document.getElementById("atkType").value, 
    ring: document.getElementById("ringRec").value, 
    armor: document.getElementById("armorRec").value, 
    skill: document.getElementById("skillOrder").value
  });
  alert("ìˆ˜ì •ì™„ë£Œ");
};
window.delAttack = ()=>{ 
  if(checkPW() && currentAttack) remove(ref(db,`defenseTeams/${currentDefense}/attackTeams/${currentAttack}`)); 
};

/* --- [ë³µêµ¬ë¨] ìœ ì € ì°¸ì—¬ í˜„í™©(ë­í‚¹) ë¡œì§ --- */
onValue(ref(db,"logs"), snap => {
  const rankingList = document.getElementById("rankingList");
  rankingList.innerHTML = "";
  
  if(!snap.exists()) {
    rankingList.innerHTML = "<div style='text-align:center; padding:10px; color:#555;'>ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
    return;
  }
  
  const stat = {};
  // ë¡œê·¸ ì§‘ê³„
  Object.values(snap.val()).forEach(v=>{
    if(!stat[v.nick]) stat[v.nick] = {w:0, l:0, total:0};
    stat[v.nick].total++;
    if(v.result === "win") stat[v.nick].w++;
    else stat[v.nick].l++;
  });
  
  // ì°¸ì—¬ íšŸìˆ˜(total) ìˆœìœ¼ë¡œ ì •ë ¬
  const sorted = Object.entries(stat).sort((a,b) => b[1].total - a[1].total);
  
  sorted.forEach(([nick, val]) => {
    const div = document.createElement("div");
    div.className = "rank-item";
    div.innerHTML = `
      <span style="font-weight:bold; color:#fff;">${nick}</span>
      <span style="color:#888;">${val.total}íšŒ ì°¸ì—¬ (${val.w}ìŠ¹ ${val.l}íŒ¨)</span>
    `;
    rankingList.appendChild(div);
  });
});

</script>
</body>
</html>
